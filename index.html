<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <title>demo test spring boot</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #eef2f3;
            color: #333;
        }

        .container1 {
    display: flex;
    justify-content: flex-start;  /* Align left by default */
    gap: 20px;
    max-width: 2500px;
    margin: 10px auto;
    padding: 10px;
}

        .container2 {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            max-width: 100px;
            margin: 20px auto;
            padding: 20px;
        }

        .left-container {
            width: 88%;
            display: flex;
            flex-direction: column;
            padding: 20px;
            border-radius: 8px;
            height: 100%;
            overflow: hidden; /* Prevent the container from expanding */
        }

        .right-container {
    width: 28%;
    display: flex;
    flex-direction: column;
    background: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    height: 100%;
    overflow: hidden;
    margin-left: auto;  /* Pushes the right container to the right */
}
.totals-summary {
    margin-top: 10px;
    padding: 15px;
    background: #eef2f3;
    border-radius: 5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.totals-summary .totals p {
    font-size: 18px;
    margin: 8px 0;
    color: #2c3e50;
}

.totals-summary .totals span {
    font-weight: bold;
    color: #27ae60;
}

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        header h1 {
            color: #2c3e50;
            font-size: 2em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        section {
            margin-bottom: 20px;
        }

        h2 {
            color: #34495e;
            border-bottom: 2px solid #e3e3e3;
            padding-bottom: 5px;
            margin-bottom: 15px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        label {
            font-weight: bold;
            color: #555;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 14px;
            width: 60%;
        }

        .product-list {
            flex-grow: 1;
            overflow-y: auto;
            max-height: 400px; /* Restrict the height of the product list */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            display: block;
        }

        table th,
        table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            min-width: 100px;
            font-size: 14px;
            word-wrap: break-word;
        }

        table th {
            background-color: #f7f7f7;
            color: #2c3e50;
            font-weight: bold;
        }

        button {
            background-color: #5cb85c;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: auto; /* Prevent the button from resizing */
        }

        button:hover {
            background-color: #4cae4c;
        }

        .totals p {
            font-size: 18px;
            margin: 8px 0;
        }

        .totals span {
            font-weight: bold;
            color: #e74c3c;
        }

        .summary {
            margin-top: 20px;
        }

        .buttons {
            display: flex;
            gap: 50px;
            margin-top: 20px;
            width: 150px;

        }

        .buttons button {
            flex: 1;
        }

        .right-container .totals {
           
            padding: 15px;
            background: #fcfcfc;
            border-radius: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .add-product-container {
            margin-top: 15px;
            text-align: center;
        }

        /* GPay logo */
        .gpay-logo {
            width: 100%;
            height: 100px;
            background-image:url('/logo.png');
            display: none;
            margin-top: 20px;
            text-align: center;
            background-repeat: no-repeat;
        }

        .card-details {
            display: none;
            margin-top: 20px;
        }
        
        .card-details input {
            width: 100%;
            padding: 8px;
            margin-top: 10px;
        }
        .product-number-label {
    margin-bottom: 10px;
    font-size: 16px;
    color: #333;
    font-weight: bold;
}

    </style>
</head>
<body onload="load()">
    <div class="container1">
        <div class="left-container">
            <header>
                <h1>Demo Testing Spring Boot</h1>
            </header>
            <section class="customer-info">
                <h2>Customer Details</h2>
                <form>
                    <label for="customer-name">Mobile Number :</label>
                    <input type="text" id="customer-name" name="mnumber" placeholder="Enter Valid Number">
                    <label for="customer-name">Name:</label>
                    <input type="text" id="customer-name" name="name" placeholder="Enter customer name">
                   
                </form>
            </section>
            <!-- <section class="totals-summary">
                <h2>Totals Summary</h2>
                <div class="totals">
                    <p>Total Invoice Amount: <span id="total-invoice-amount">$0.00</span></p>
                    <p>Collected Total Tax: <span id="collected-total-tax">$0.00</span></p>
                </div>
            </section> -->
            <section class="product-list">
                <h2>Products</h2>
                <div class="product-number-label">
                    <label>No:</label>
                    <span id="product-number">1</span> <!-- This will display the product number -->
                </div>
                <table id="product-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Rows will be added dynamically -->
                    </tbody>
                </table>
            </section>
            
            <div class="add-product-container">
                <button onclick="addProduct()">
                    <img src="soft/src/main/resources/static/cart.png" alt="Add Product" class="button-icon">
                </button>
            </div>
        </div>
        
        <div class="right-container">
            <section class="invoice-details">
                <h2>Invoice Details</h2>
                <form>
                    <label for="invoice-date">Date: (Auto)</label>
                    <input type="text" id="invoice-date" name="date" placeholder="Select a date">

                    <label for="balance-due">Balance Due:</label>
                    <input type="text" id="balance-due" placeholder="Enter balance due">

                    <label for="collected-amount">Collected Amount:</label>
                    <input type="text" id="collected-amount" placeholder="Enter collected amount">

                    <label for="changes-due">Changes Due:</label>
                    <input type="text" id="changes-due" placeholder="Enter changes due">

                    <label for="payment-mode">Payment Mode:</label>
                    <select id="payment-mode" onchange="handlePaymentModeChange()">
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="gpay">GPay</option>
                    </select>
                </form>

                <!-- Card Details Section -->
                <div class="card-details" id="card-details">
                    <label for="card-number">Card Number:</label>
                    <input type="text" id="card-number" placeholder="Enter card number">
                    <label for="card-expiry">Expiry Date:</label>
                    <input type="text" id="card-expiry" placeholder="MM/YY">
                    <label for="card-cvc">CVC:</label>
                    <input type="text" id="card-cvc" placeholder="CVC">
                </div>

                <!-- GPay Logo Section -->
                <div class="gpay-logo" id="gpay-logo">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/0/0e/GPay_logo.svg" alt="GPay" width="100">
                </div>
            </section>
            
            <section class="summary">
                <h2>Summary</h2>
                <div class="totals">
                    <p>Subtotal: <span id="subtotal">$0.00</span></p>
                    <p>Tax (10%): <span id="tax">$0.00</span></p>
                    <p>Discount: <span id="discount">$0.00</span></p>
                    <p>Round Off: <span id="roundoff">$0.00</span></p>
                    <p>Total: <span id="total">$0.00</span></p>
                </div>
                <div class="buttons">
                    <form action="/saveInvoice" method="post">
                        <button onclick="saveInvoice()">
                            <img src="soft/src/main/resources/static/save.png" alt="Save" class="button-icon"> Save
                        </button>
                    </form>
                    <button onclick="generateInvoice()">
                        <img src="soft/src/main/resources/static/money.png" alt="Pay" class="button-icon"> Pay
                    </button>
                </div>
            </section>
        </div>
    </div>

    <script>
        let productId = 0;
        let count=0;
        
    flatpickr("#invoice-date", {
        dateFormat: "Y-m-d", // yyyy-MM-dd format
    });
    window.onload = function () {
        load();
    };

    function load() {
        console.log("Load function called");
        try {
            flatpickr("#invoice-date", {
                dateFormat: "Y-m-d",
            });

            const invoiceDateField = document.getElementById('invoice-date');
            const today = new Date().toISOString().split('T')[0];
            invoiceDateField.value = today;
            console.log("Page loaded successfully");
        } catch (error) {
            console.error("Error in load function:", error);
        }
    }

        function addProduct() {
            productId++;  // Increment productId for each product added

// Update the product number displayed in the label
document.getElementById('product-number').textContent = productId;

const tableBody = document.querySelector('#product-table tbody');
const row = document.createElement('tr');
row.setAttribute('id', `product-${productId}`);
row.innerHTML = `
    <td><input type="text" placeholder="Product name"></td>
    <td><input type="number" min="1" value="1" onchange="updateTotal(${productId})"></td>
    <td><input type="number" min="0.01" step="0.01" value="0.00" onchange="updateTotal(${productId})"></td>
    <td><input type="text" readonly value="0.00"></td>
    <td><button onclick="removeProduct(${productId})">
    <img src="soft/src/main/resources/static/dustbin.png" alt="Remove Product" class="button-icon">
</button></td>
`;
count += 1;

// Prepend the new row at the beginning of the table body (reverse order)
tableBody.insertBefore(row, tableBody.firstChild);
}

        function updateTotal(id) {
            const row = document.querySelector(`#product-${id}`);
            const quantity = row.querySelector('td:nth-child(2) input').value;
            const price = row.querySelector('td:nth-child(3) input').value;
            const totalField = row.querySelector('td:nth-child(4) input');
            const total = (quantity * price).toFixed(2);
            totalField.value = `$${total}`;
            calculateSummary();
        }

        function removeProduct(id) {
            const row = document.getElementById(`product-${id}`);
    if (row) {
        row.remove();
        count -= 1;

        // After removing a product, update the product number
        productId = count + 1; // Update productId to match the current count
        document.getElementById('product-number').textContent = productId; // Update label with new product number
    }
        }

        function calculateSummary() {
    const rows = document.querySelectorAll('#product-table tbody tr');
    let subtotal = 0;
    
    // Calculate subtotal from all product rows
    rows.forEach(row => {
        const totalField = row.querySelector('td:nth-child(4) input').value.replace('$', '');
        subtotal += parseFloat(totalField);
    });

    const tax = (subtotal * 0.1).toFixed(2); // 10% tax
    const discount = (subtotal * 0.05).toFixed(2); // Example: 5% discount
    const roundoff = Math.round(subtotal + parseFloat(tax) - discount) - (subtotal + parseFloat(tax) - discount);
    const total = (subtotal + parseFloat(tax) - discount + roundoff).toFixed(2); // Final total

    // Calculate collected amount, balance due, and changes due
    const collectedAmount = parseFloat(document.getElementById('collected-amount').value) || 0;
    const balanceDue = (parseFloat(total) - collectedAmount).toFixed(2); // Balance due = Total - Collected amount
    const changesDue = (collectedAmount - parseFloat(total) > 0) ? (collectedAmount - parseFloat(total)).toFixed(2) : 0; // Changes due if overpaid

    // Update the UI with these values
    document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
    document.getElementById('tax').textContent = `$${tax}`;
    document.getElementById('discount').textContent = `$${discount}`;
    document.getElementById('roundoff').textContent = `$${roundoff.toFixed(2)}`;
    document.getElementById('total').textContent = `$${total}`;
    document.getElementById('collected-amount').value = collectedAmount.toFixed(2); // Update the collected amount field
    document.getElementById('balance-due').value = balanceDue; // Update balance due
    document.getElementById('changes-due').value = changesDue; // Update changes due
}


function saveInvoice() {
    // Collect customer details from form inputs
    const mobileNumber = document.getElementById('customer-name').value;
    const customerName = document.querySelector('input[name="name"]').value;
    const invoiceDate = document.getElementById('invoice-date').value;
    const balanceDue = document.getElementById('balance-due').value;
    const collectedAmount = document.getElementById('collected-amount').value;
    const changesDue = document.getElementById('changes-due').value;
    const paymentMode = document.getElementById('payment-mode').value;

    let cardDetails = null;
    if (paymentMode === 'card') {
        cardDetails = JSON.stringify({
            cardNumber: document.getElementById('card-number').value,
            cardExpiry: document.getElementById('card-expiry').value,
            cardCvc: document.getElementById('card-cvc').value,
        });
    }

    const products = [];
    const rows = document.querySelectorAll('#product-table tbody tr');
    rows.forEach(row => {
        const item = row.querySelector('td:nth-child(1) input').value;
        const quantity = row.querySelector('td:nth-child(2) input').value;
        const price = row.querySelector('td:nth-child(3) input').value;
        const total = row.querySelector('td:nth-child(4) input').value;
        products.push({ item, quantity, price, total });
    });

    // Create the invoice data
    const invoiceData = {
        mobileNumber,
        customerName,
        invoiceDate,
        balanceDue: parseFloat(balanceDue),
        collectedAmount: parseFloat(collectedAmount),
        changesDue: parseFloat(changesDue),
        paymentMode,
        cardDetails,
        products: JSON.stringify(products),  // Converting products to string
    };

    // Now wrap the invoice data in a JSON object for the backend request
    const invoiceRequest = {
        mobileNumber: mobileNumber,
        jsonData: JSON.stringify(invoiceData),  // Wrap data in jsonData as a string
    };
    console.log(invoiceData);
    // Make an AJAX request to send the data to the backend
    fetch('/saveInvoice', {
        method: 'POST',
        headers: {
           'Content-Type': 'application/json; charset= utf-8',  // Ensure the Content-Type is set to application/json
        },
        body: JSON.stringify(invoiceRequest),  // Ensure body is a stringified JSON object
    })
    .then(response => response.json())
    .then(data => {
        console.log('Invoice saved successfully:', data);
        alert("Invoice saved successfully!");
        // Optionally, redirect or reset the form after saving
        window.location.href = "/home";  // Redirect to the home page after successful save
    })
    .catch(error => {
        // console.log('Error saving invoice:', error);
        // alert("Error saving invoice!");
    });
}




        function generateInvoice() {
            alert('Payment processed successfully!');
        }

        // Handle changes in payment mode selection
        function handlePaymentModeChange() {
            const paymentMode = document.getElementById('payment-mode').value;
            const cardDetails = document.getElementById('card-details');
            const gpayLogo = document.getElementById('gpay-logo');

            // Hide both sections first
            cardDetails.style.display = 'none';
            gpayLogo.style.display = 'none';

            // Show relevant section based on selected payment mode
            if (paymentMode === 'card') {
                cardDetails.style.display = 'block';
            } else if (paymentMode === 'gpay') {
                gpayLogo.style.display = 'block';
            }
        }
    </script>
</body>
</html>
